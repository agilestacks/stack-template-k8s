---
version: 1
kind: stack
meta:
  name: k8s-aws:1
  brief: Kubernetes with DevOps services
  description: Kubernetes on AWS

components:
  - name: stack-k8s-aws
    source:
      git:
        remote: git@github.com:agilestacks/stack-k8s-aws.git
        ref: refs/heads/master
        localDir: stack-k8s-aws

requires:
  - aws
provides:
  - kubernetes

lifecycle:
  verbs: [deploy, undeploy]
  order: [stack-k8s-aws]

outputs:
  - name: stack-k8s-aws:dns.domain
    brief: Stack domain
  - name: stack-k8s-aws:kubernetes.api.endpoint
    brief: Kubernetes API endpoint
  - name: stack-k8s-aws:kubernetes.api.caCert
  - name: stack-k8s-aws:kubernetes.api.clientCert
  - name: stack-k8s-aws:kubernetes.api.clientKey
  - name: cloud.kind
  - name: cloud.region
  - name: cloud.availabilityZone
  - name: stack-k8s-aws:cloud.role.master
  - name: stack-k8s-aws:cloud.role.worker
  - name: stack-k8s-aws:cloud.vpc.id
  - name: stack-k8s-aws:cloud.vpc.cidr
  - name: stack-k8s-aws:cloud.vpc.master.subnet.id
  - name: stack-k8s-aws:cloud.vpc.master.sg.id
  - name: stack-k8s-aws:cloud.vpc.worker.subnet.id
  - name: stack-k8s-aws:cloud.vpc.worker.subnet.ids
  - name: stack-k8s-aws:cloud.vpc.worker.sg.id
  - name: stack-k8s-aws:cloud.iam.worker.instanceProfile

parameters:
  - name: cloud
    brief: Cloud
    kind: user
    parameters:
      - name: kind
        value: aws
      - name: region
        env: AWS_DEFAULT_REGION
      - name: availabilityZone
        brief: Availability zone
      - name: sshKey
        brief: SSH key name
  - name: dns
    brief: DNS
    kind: user
    parameters:
      - name: name
        brief: DNS name
      - name: baseDomain
        brief: DNS base domain
        default: superhub.io
  - name: terraform.bucket
    brief: Terraform state location
    parameters:
      - name: name
        env: STATE_BUCKET
      - name: region
        env: STATE_REGION
